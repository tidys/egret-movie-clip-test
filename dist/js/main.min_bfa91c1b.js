var __reflect=this&&this.__reflect||function(e,t,n){e.__class__=t,n?n.push(t):n=[t],e.__types__=e.__types__?n.concat(e.__types__):n},__extends=this&&this.__extends||function(e,t){function n(){this.constructor=e}for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r]);n.prototype=t.prototype,e.prototype=new n},__awaiter=this&&this.__awaiter||function(e,t,n,r){return new(n||(n=Promise))(function(i,o){function a(e){try{c(r.next(e))}catch(t){o(t)}}function s(e){try{c(r["throw"](e))}catch(t){o(t)}}function c(e){e.done?i(e.value):new n(function(t){t(e.value)}).then(a,s)}c((r=r.apply(e,t||[])).next())})},__generator=this&&this.__generator||function(e,t){function n(e){return function(t){return r([e,t])}}function r(n){if(i)throw new TypeError("Generator is already executing.");for(;c;)try{if(i=1,o&&(a=o[2&n[0]?"return":n[0]?"throw":"next"])&&!(a=a.call(o,n[1])).done)return a;switch(o=0,a&&(n=[0,a.value]),n[0]){case 0:case 1:a=n;break;case 4:return c.label++,{value:n[1],done:!1};case 5:c.label++,o=n[1],n=[0];continue;case 7:n=c.ops.pop(),c.trys.pop();continue;default:if(a=c.trys,!(a=a.length>0&&a[a.length-1])&&(6===n[0]||2===n[0])){c=0;continue}if(3===n[0]&&(!a||n[1]>a[0]&&n[1]<a[3])){c.label=n[1];break}if(6===n[0]&&c.label<a[1]){c.label=a[1],a=n;break}if(a&&c.label<a[2]){c.label=a[2],c.ops.push(n);break}a[2]&&c.ops.pop(),c.trys.pop();continue}n=t.call(e,c)}catch(r){n=[6,r],o=0}finally{i=a=0}if(5&n[0])throw n[1];return{value:n[0]?n[1]:void 0,done:!0}}var i,o,a,s,c={label:0,sent:function(){if(1&a[0])throw a[1];return a[1]},trys:[],ops:[]};return s={next:n(0),"throw":n(1),"return":n(2)},"function"==typeof Symbol&&(s[Symbol.iterator]=function(){return this}),s},LoadingUI=function(e){function t(){var t=e.call(this)||this;return t.createView(),t}return __extends(t,e),t.prototype.createView=function(){this.textField=new egret.TextField,this.addChild(this.textField),this.textField.y=300,this.textField.width=480,this.textField.height=100,this.textField.textAlign="center"},t.prototype.onProgress=function(e,t){this.textField.text="Loading..."+e+"/"+t},t}(egret.Sprite);__reflect(LoadingUI.prototype,"LoadingUI",["RES.PromiseTaskReporter"]);var Main=function(e){function t(){var t=e.call(this)||this;return t.addEventListener(egret.Event.ADDED_TO_STAGE,t.onAddToStage,t),t}return __extends(t,e),t.prototype.onAddToStage=function(e){egret.lifecycle.addLifecycleListener(function(e){e.onUpdate=function(){}}),egret.lifecycle.onPause=function(){egret.ticker.pause()},egret.lifecycle.onResume=function(){egret.ticker.resume()},this.runGame()["catch"](function(e){console.log(e)})},t.prototype.runGame=function(){return __awaiter(this,void 0,void 0,function(){var e;return __generator(this,function(t){switch(t.label){case 0:return[4,this.loadResource()];case 1:return t.sent(),this.createGameScene(),[4,RES.getResAsync("description_json")];case 2:return e=t.sent(),[2]}})})},t.prototype.loadResource=function(){return __awaiter(this,void 0,void 0,function(){var e,t;return __generator(this,function(n){switch(n.label){case 0:return n.trys.push([0,3,,4]),e=new LoadingUI,this.stage.addChild(e),[4,RES.loadConfig("resource/default.res.json","resource/")];case 1:return n.sent(),[4,RES.loadGroup("preload",0,e)];case 2:return n.sent(),this.stage.removeChild(e),[3,4];case 3:return t=n.sent(),console.error(t),[3,4];case 4:return[2]}})})},t.prototype.readText=function(e){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(t){return[2,new Promise(function(t,n){var r=new FileReader;r.onload=function(e){var n=e.target;if(n){var r=n.result;t(r)}},r.readAsText(e)})]})})},t.prototype.readArrayBuffer=function(e){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(t){return[2,new Promise(function(t,n){var r=new FileReader;r.onload=function(e){var n=e.target;if(n){var r=n.result;t(r)}},r.readAsArrayBuffer(e)})]})})},t.prototype.dealFileList=function(e,t){return __awaiter(this,void 0,void 0,function(){var n,r,i,o;return __generator(this,function(a){switch(a.label){case 0:if(e.length<1)return[2];if(2!==e.length)return alert("需要2个文件(*.json/*.png)"),[2];n="",r=null,i=0,a.label=1;case 1:return i<e.length?(o=e[i],o.name.endsWith(".json")?[4,this.readText(o)]:[3,3]):[3,6];case 2:return n=a.sent(),[3,5];case 3:return[4,this.readArrayBuffer(o)];case 4:r=a.sent(),a.label=5;case 5:return i++,[3,1];case 6:return n&&r&&t&&t(n,r),[2]}})})},t.prototype.upload=function(e){var t=this,n=document.createElement("input");n.type="file",n.multiple=!0,n.accept="image/*, application/json",n.addEventListener("change",function(){return __awaiter(t,void 0,void 0,function(){return __generator(this,function(t){switch(t.label){case 0:return[4,this.dealFileList(n.files,e)];case 1:return t.sent(),[2]}})})}),n.style.display="none",document.body.appendChild(n),n.click(),document.body.removeChild(n)},t.prototype.initLabel=function(){var e=new egret.TextField;this.addChild(e),e.width=this.stage.stageWidth,e.textAlign=egret.HorizontalAlign.CENTER,e.size=24,e.textColor=16777215,e.x=0,e.y=30,e.text="点击任意位置上传MovieClip(*.json/*.png)",this.textfield=e},t.prototype.resize=function(){var e=document.body,t=e.clientWidth,n=e.clientHeight;this.stage.setContentSize(t,n)},t.prototype.ondrag=function(){var e=this,t=this.stage.$screen.canvas;t.draggable=!1,t.addEventListener("drop",function(t){t.preventDefault(),t.stopPropagation(),e.dealFileList(t.dataTransfer.files,e.createMc.bind(e))}),t.addEventListener("dragover",function(e){e.preventDefault(),e.stopPropagation()}),t.addEventListener("dragenter",function(e){e.preventDefault(),e.stopPropagation()}),t.addEventListener("dragleave",function(e){e.preventDefault(),e.stopPropagation()})},t.prototype.createGameScene=function(){var e=this;this.stage.scaleMode=egret.StageScaleMode.SHOW_ALL,this.resize(),window.addEventListener("resize",function(){e.resize()}),this.ondrag();var t=0,n=0;this.stage.addEventListener(egret.TouchEvent.TOUCH_BEGIN,function(e){e.stopPropagation(),e.stopImmediatePropagation(),e.preventDefault(),t=e.stageX,n=e.stageY},this),this.stage.addEventListener(egret.TouchEvent.TOUCH_MOVE,function(r){var i=r.stageX-t,o=r.stageY-n;e.mc1&&(e.mc1.x+=i,e.mc1.y+=o),t=r.stageX,n=r.stageY},this),document.body.addEventListener("wheel",function(t){if(e.mc1){var n=e.mc1.scaleX-.001*t.deltaY;n=Math.max(n,.1),e.mc1.scaleX=n,e.mc1.scaleY=n}}),this.createList([{name:"default movie clip",cb:function(){e.loadDefaultMc()}},{name:"upload movie clip",cb:function(){e.upload(e.createMc.bind(e))}},{name:"reset movie clip",cb:function(){e.mc1&&(e.mc1.scaleX=e.mc1.scaleY=1,e.mc1.x=e.stage.stageWidth/2,e.mc1.y=e.stage.stageHeight/2)}}]),this.loadDefaultMc()},t.prototype.createMc=function(e,t){var n=this;egret.BitmapData.create("arraybuffer",t,function(t){var r=new egret.Texture;r._setBitmapData(t),n.loadMc(JSON.parse(e),r)})},t.prototype.loadDefaultMc=function(){var e=RES.getRes("82_json"),t=RES.getRes("82_png");this.loadMc(e,t)},t.prototype.getRandomColor=function(){var e=Math.floor(256*Math.random()),t=Math.floor(256*Math.random()),n=Math.floor(256*Math.random());return e<<16|t<<8|n},t.prototype.createList=function(e){for(var t=this,n=0,r=function(r){var o=e[r],a=new egret.TextField;a.text=o.name,a.touchEnabled=!0,a.addEventListener(egret.TouchEvent.TOUCH_TAP,function(e){a.textColor=t.getRandomColor(),o.cb(e),e.stopImmediatePropagation(),e.preventDefault(),e.stopPropagation()},i),a.$anchorOffsetX=1,a.y=n,n+=a.height,i.stage.addChild(a)},i=this,o=0;o<e.length;o++)r(o)},t.prototype.loadMc=function(e,t){this.mc1&&(this.removeChild(this.mc1),this.mc1=null);var n=Object.keys(e.mc),r=new egret.MovieClipDataFactory(e,t),i=new egret.MovieClip(r.generateMovieClipData(n[0]));i.x=this.stage.stageWidth/2,i.y=this.stage.stageHeight/2,i.play(-1);var o=this.stage.stageWidth/i.width,a=this.stage.stageHeight/i.height,s=Math.min(o,a);i.scaleX=s,i.scaleY=s,this.addChild(i),this.mc1=i},t.prototype.createBitmapByName=function(e){var t=new egret.Bitmap,n=RES.getRes(e);return t.texture=n,t},t}(egret.DisplayObjectContainer);__reflect(Main.prototype,"Main");var DebugPlatform=function(){function e(){}return e.prototype.getUserInfo=function(){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(e){return[2,{nickName:"username"}]})})},e.prototype.login=function(){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(e){return[2]})})},e}();__reflect(DebugPlatform.prototype,"DebugPlatform",["Platform"]),window.platform||(window.platform=new DebugPlatform);